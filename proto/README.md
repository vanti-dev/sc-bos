# Project specific APIs

## Re-generating source code

These proto files are used to generate both Go and JavaScript grpc-web source files. The Go files end up in `pkg/gen` and the JavaScript files end up in `ui/ui-gen/proto`. Use the `genproto` tool to execute the generator and perform cleanup of the files afterwards.

```shell
go run ./cmd/tools/genproto
```

## Required tooling

The generated source files typically mention which version of `protoc` and the plugins in a comment at the top of the file. Here is the comment at the top of `pkg/gen/alerts.pb.go`

```go
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
// 	protoc-gen-go v1.28.1
// 	protoc        v3.21.12
// source: alerts.proto
```

The project needs:

1. `protoc`
2. `protoc-gen-go`
3. `protoc-gen-go-grpc`
4. `protoc-gen-js`
5. `protoc-gen-grpc-web`

The current state of protoc is a little broken right now, the project is in the process of pulling out a lot of the bundled generators into their own projects. This doesn't really affect us apart from the javascript generator which is both not in the protoc distribution and not available via package managers. You will need to install protobuf-javascript binary manually.

To do this, get the version that matches protoc from their [release page](https://github.com/protocolbuffers/protobuf-javascript/releases) (3.21.2 at time of writing), extract it, and make the `bin/protoc-gen-js` executable available on your path. For example copy it into `/usr/local/bin`.

### MacOS homebrew users

Installing `protoc-gen-grpc-web` via brew also installs `protobuf@3` which equates to real version 3.20.3. The project uses a version newer than this by default. To fix this simply `brew install protobuf` after you've `brew install protoc-gen-grpc-web` to overwrite the default `protoc` executable path.

Verify your install via `protoc --version`.
